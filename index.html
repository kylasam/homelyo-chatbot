<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homelyo - Premium Living in Berlin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Lottie for animated avatar -->
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    
    <style>
        /* [Keep all your existing CSS styles here - no changes needed] */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
        }
        
        /* ... [rest of your CSS - keep everything as is] ... */
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Sidebar -->
        <div class="property-sidebar">
            <div class="logo-section">
                <!-- ‚úÖ FIXED LOGO URL -->
                <img src="https://raw.githubusercontent.com/kylasam/homelyo-chatbot/main/assets/homelyo-logo.png" alt="Homelyo Logo">
                <h1>Homelyo</h1>
                <div class="location">
                    <span>üìç</span>
                    <span>Lichtenrader Damm, 12305 Berlin</span>
                </div>
            </div>
            
            <div class="info-section">
                <h3>About</h3>
                <p>Premium co-living in Berlin's peaceful Lichtenrade district with modern amenities and excellent transport connections.</p>
            </div>
            
            <div class="info-section">
                <h3>Features & Perks</h3>
                <div class="features-list">
                    <div class="feature-item">
                        <span class="icon">üõèÔ∏è</span>
                        <span>Fully furnished rooms with modern amenities</span>
                    </div>
                    <div class="feature-item">
                        <span class="icon">üöø</span>
                        <span>Newly renovated, cozy bathrooms</span>
                    </div>
                    <div class="feature-item">
                        <span class="icon">üè™</span>
                        <span>Groceries & bus stops within 3 minutes walk</span>
                    </div>
                    <div class="feature-item">
                        <span class="icon">ü•¨</span>
                        <span>Bio Company supermarket right across the building</span>
                    </div>
                    <div class="feature-item">
                        <span class="icon">üì¶</span>
                        <span>Extra storage room to keep your belongings safe</span>
                    </div>
                    <div class="feature-item">
                        <span class="icon">üéÅ</span>
                        <span>Warm onboarding & welcome kit to feel at home</span>
                    </div>
                    <div class="feature-item">
                        <span class="icon">üöá</span>
                        <span>U6 underground station nearby</span>
                    </div>
                    <div class="feature-item">
                        <span class="icon">üå≥</span>
                        <span>Green, peaceful neighborhood</span>
                    </div>
                    <div class="feature-item">
                        <span class="icon">‚ú®</span>
                        <span>Modern, well-maintained facilities</span>
                    </div>
                    <div class="feature-item">
                        <span class="icon">üö≠</span>
                        <span>Strict no-smoking policy</span>
                    </div>
                    <div class="feature-item">
                        <span class="icon">üêï</span>
                        <span>Pet-free environment for allergy-sensitive tenants</span>
                    </div>
                </div>
            </div>
            
            <div class="info-section">
                <h3>Available Rooms</h3>
                <div class="rooms-grid">
                    <a href="https://www.homelyo.eu/ke1" target="_blank" class="room-link">KE1</a>
                    <a href="https://www.homelyo.eu/ke2" target="_blank" class="room-link">KE2</a>
                    <a href="https://www.homelyo.eu/ke3" target="_blank" class="room-link">KE3</a>
                    <a href="https://www.homelyo.eu/ke4" target="_blank" class="room-link">KE4</a>
                </div>
            </div>
            
            <div class="info-section">
                <a href="https://www.homelyo.eu/contact-us" target="_blank" class="cta-button">
                    üìß Submit Booking Request
                </a>
            </div>
        </div>
        
        <!-- Chat Interface -->
        <div class="chat-container">
            <div class="chat-header">
                <!-- ‚úÖ ANIMATED SARA AVATAR -->
                <div class="chat-header-avatar">
                    <lottie-player 
                        src="https://lottie.host/4f7ef4ac-3a8f-4836-85e4-c7aa7b3c0e7e/y4H6FLbsum.json" 
                        background="transparent" 
                        speed="1" 
                        style="width: 100%; height: 100%;" 
                        loop 
                        autoplay>
                    </lottie-player>
                </div>
                <div class="chat-header-text">
                    <h2>Sara from Homelyo</h2>
                    <p>üü¢ Online ‚Ä¢ Ready to assist you</p>
                </div>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <!-- Introduction message will be added by JavaScript -->
            </div>
            
            <div class="chat-input-container">
                <input 
                    type="text" 
                    id="messageInput" 
                    placeholder="Type your message..." 
                    autocomplete="off"
                >
                <button id="sendButton">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        const WEBHOOK_URL = 'https://assistant-proxy.kylashpriya.workers.dev/';

        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');

        function initializeChat() {
            const introDiv = document.createElement('div');
            introDiv.className = 'intro-message';
            introDiv.innerHTML = `
                <h3>üëã Hey! I'm Sara</h3>
                <p>Your personal assistant for <span class="highlight">Homelyo at Lichtenrader Damm, 12305 Berlin</span>.</p>
                <p style="margin-top: 8px;">I can help you with:</p>
                <p>‚úì Room availability (KE1, KE2, KE3, KE4)<br>
                ‚úì Pricing and amenities<br>
                ‚úì Booking process<br>
                ‚úì Location & transport info</p>
                <p style="margin-top: 10px; font-size: 11px; opacity: 0.8;">How can I help you today?</p>
            `;
            chatMessages.appendChild(introDiv);
        }

        function addMessage(text, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'avatar';
            
            if (isUser) {
                avatarDiv.textContent = 'üë§';
            } else {
                // ‚úÖ ANIMATED SARA AVATAR IN MESSAGES
                avatarDiv.innerHTML = '<lottie-player src="https://lottie.host/4f7ef4ac-3a8f-4836-85e4-c7aa7b3c0e7e/y4H6FLbsum.json" background="transparent" speed="1" style="width: 100%; height: 100%;" loop autoplay></lottie-player>';
            }
            
            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';
            contentDiv.textContent = text;
            
            messageDiv.appendChild(avatarDiv);
            messageDiv.appendChild(contentDiv);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTyping() {
            const typingWrapper = document.createElement('div');
            typingWrapper.className = 'typing-indicator-wrapper';
            typingWrapper.id = 'typing-indicator-wrapper';
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'avatar';
            avatarDiv.innerHTML = '<lottie-player src="https://lottie.host/4f7ef4ac-3a8f-4836-85e4-c7aa7b3c0e7e/y4H6FLbsum.json" background="transparent" speed="1" style="width: 100%; height: 100%;" loop autoplay></lottie-player>';
            
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator active';
            typingDiv.innerHTML = '<span></span><span></span><span></span>';
            
            typingWrapper.appendChild(avatarDiv);
            typingWrapper.appendChild(typingDiv);
            chatMessages.appendChild(typingWrapper);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTyping() {
            const typingIndicator = document.getElementById('typing-indicator-wrapper');
            if (typingIndicator) typingIndicator.remove();
        }

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            messageInput.disabled = true;
            sendButton.disabled = true;
            
            addMessage(message, true);
            const originalMessage = message;
            messageInput.value = '';
            showTyping();
            
            try {
                const response = await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message })
                });

                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();

                hideTyping();
                
                if (data.reply && data.reply.trim()) {
                    addMessage(data.reply, false);
                } else {
                    addMessage('I apologize, but I encountered an issue. Could you please rephrase your question?', false);
                }

                if (data.trigger_form === true || (data.reply && data.reply.includes("I'll open our booking form"))) {
                    const roomMatch = originalMessage.match(/\b(KE[1-4])\b/i);
                    const room = roomMatch ? roomMatch[0].toUpperCase() : '';
                    
                    let formUrl = 'https://docs.google.com/forms/d/e/1FAIpQLScajW2ZtiXfJHKTwAoAA22CTrJ3srWVPqTkABLxj2-iRV2J7A/viewform';
                    if (room) formUrl += `?entry.952874026=${room}`;
                    
                    setTimeout(() => {
                        window.open(formUrl, '_blank', 'noopener,noreferrer');
                    }, 1500);
                }

            } catch (err) {
                console.error('Error:', err);
                hideTyping();
                addMessage('I apologize for the inconvenience. Please try again or contact support@homelyo.eu.', false);
            } finally {
                messageInput.disabled = false;
                sendButton.disabled = false;
                messageInput.focus();
            }
        }

        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        sendButton.addEventListener('click', sendMessage);

        window.addEventListener('load', () => {
            initializeChat();
            messageInput.focus();
        });
    </script>
</body>
</html>
